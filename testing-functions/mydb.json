{
    "name": "mydb",
    "owner": null,
    "extensions": null,
    "tables": [
        {
            "name": "posts",
            "columns": [
                {
                    "name": "id",
                    "type": {
                        "name": "int",
                        "isArray": false
                    },
                    "attributes": [
                        {
                            "type": "PRIMARY_KEY"
                        },
                        {
                            "type": "NOT_NULL"
                        }
                    ]
                },
                {
                    "name": "name",
                    "type": {
                        "name": "text",
                        "isArray": false
                    },
                    "attributes": [
                        {
                            "type": "NOT_NULL"
                        }
                    ]
                },
                {
                    "name": "post_title",
                    "type": {
                        "name": "text",
                        "isArray": false
                    },
                    "attributes": [
                        {
                            "type": "NOT_NULL"
                        }
                    ]
                },
                {
                    "name": "post_body",
                    "type": {
                        "name": "text",
                        "isArray": false
                    },
                    "attributes": [
                        {
                            "type": "NOT_NULL"
                        }
                    ]
                }
            ],
            "foreign_keys": null
        }
    ],
    "actions": [
        {
            "name": "add_post",
            "parameters": [
                "$id",
                "$user",
                "$title",
                "$body"
            ],
            "public": true,
            "modifiers": null,
            "body": "INSERT INTO posts VALUES ( $id , $user , $title , $body );"
        },
        {
            "name": "update_post",
            "parameters": [
                "$body",
                "$id"
            ],
            "public": true,
            "modifiers": null,
            "body": "UPDATE posts SET post_body = $body WHERE id = $id;"
        },
        {
            "name": "delete_post",
            "parameters": [
                "$id"
            ],
            "public": true,
            "modifiers": null,
            "body": "DELETE FROM posts WHERE id = $id;"
        },
        {
            "name": "read_posts",
            "parameters": null,
            "public": true,
            "modifiers": [
                "VIEW"
            ],
            "body": "SELECT count(*) FROM posts;"
        },
        {
            "name": "view_with_param",
            "parameters": [
                "$id"
            ],
            "public": true,
            "modifiers": [
                "VIEW"
            ],
            "body": "SELECT * from posts WHERE id = $id;"
        },
        {
            "name": "view_must_sign",
            "annotations": [
                "@kgw(authn='true')"
            ],
            "parameters": null,
            "public": true,
            "modifiers": [
                "VIEW"
            ],
            "body": "SELECT * from posts;"
        },
        {
            "name": "view_caller",
            "annotations": [
                "@kgw(authn='true')"
            ],
            "parameters": null,
            "public": true,
            "modifiers": [
                "VIEW"
            ],
            "body": "SELECT @caller AS caller;"
        }
    ],
    "procedures": [
        {
            "name": "get_post_by_id",
            "parameters": [
                {
                    "name": "$id",
                    "type": {
                        "name": "int",
                        "isArray": false
                    }
                }
            ],
            "public": true,
            "modifiers": [
                "VIEW"
            ],
            "body": "for $row in SELECT post_title, post_body FROM posts WHERE id = $id {\n        return $row.post_title, $row.post_body; \n    }\n\n    error(format('record with id = \"%s\" not found', $id));",
            "returnTypes": {
                "isTable": false,
                "fields": [
                    {
                        "name": "title",
                        "type": {
                            "name": "text",
                            "isArray": false
                        }
                    },
                    {
                        "name": "body",
                        "type": {
                            "name": "text",
                            "isArray": false
                        }
                    }
                ]
            }
        }
    ]
}